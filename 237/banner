#!/bin/sh /etc/rc.common
START=99

start() {
cat > /etc/banner << 'EOF'
=============================================
  ____  _   _ _   _ ____ _____ _____ ____
 / __ \| \ | | \ | |  _ \_   _|_   _/ __ \
| |  | |  \| | \| | |_) || |   | | | |  | |
| |__| | |\  | |\  |  _ < | |   | | | |__| |
 \____/|_| \_|_| \_|_| \_\|_|   |_|  \____/
==============================================
             Designed by WindyDay
EOF

echo "设备型号: $(cat /tmp/sysinfo/model 2>/dev/null || echo "Netcore N60 Pro")" >> /etc/banner

# 处理器信息
CPU_INFO=$(awk -F: '/model name|Processor/ {print $2; exit}' /proc/cpuinfo | sed 's/^ //')
[ -z "$CPU_INFO" ] && CPU_INFO="Unknown"
echo "处理器: ${CPU_INFO}" >> /etc/banner

# Overlay 空间
OVERLAY_SPACE=$(df -h | awk '$NF=="/overlay" || ($NF=="/" && $1=="overlay") {print $4 " / " $2 " (" $5 ")"; exit}')
[ -z "$OVERLAY_SPACE" ] && OVERLAY_SPACE="N/A"
echo "存储空间: ${OVERLAY_SPACE}" >> /etc/banner

# 内存信息
MEM_TOTAL_KB=$(awk '/MemTotal/ {print $2}' /proc/meminfo)
MEM_FREE_KB=$(awk '/MemAvailable/ {print $2}' /proc/meminfo)
MEM_USED_KB=$((MEM_TOTAL_KB - MEM_FREE_KB))

MEM_TOTAL_MB=$((MEM_TOTAL_KB / 1024))
MEM_USED_MB=$((MEM_USED_KB / 1024))
MEM_PERCENT=$(awk "BEGIN {printf \"%.1f\", ${MEM_USED_MB}/${MEM_TOTAL_MB}*100}")

echo "运行内存: ${MEM_PERCENT}% (${MEM_USED_MB}MB/${MEM_TOTAL_MB}MB)" >> /etc/banner

# 固件版本
FW_VERSION=$(grep -E 'DISTRIB_(DESCRIPTION|REVISION)' /etc/openwrt_release 2>/dev/null | cut -d"'" -f2 | head -n1)
[ -z "$FW_VERSION" ] && FW_VERSION="Unknown"
echo "固件版本: ${FW_VERSION}" >> /etc/banner

echo "内核版本: $(uname -r)" >> /etc/banner
echo "运行时间: $(uptime | sed 's/.*up //; s/,.*//')" >> /etc/banner

LAN_IP=$(ip -4 addr show br-lan 2>/dev/null | awk '/inet / {sub(/\/.*/,"",$2); print $2}')
[ -z "$LAN_IP" ] && LAN_IP="N/A"
echo "Lan地址: ${LAN_IP}" >> /etc/banner

CPU_TEMP=$(awk '{printf "%.1f°C", $1/1000}' /sys/class/thermal/thermal_zone0/temp 2>/dev/null || echo "N/A")
echo "CPU温度: ${CPU_TEMP}" >> /etc/banner
}
